# 项目文件分类

## 📁 核心应用文件

### 🚀 启动入口
- **`app.pyw`** - 主应用程序入口，负责创建窗口和启动应用
- **`app_optimized.pyw`** - 优化版本的启动文件（备份）

### 🔧 核心业务模块
- **`main_api.pyw`** - 主API接口，连接前端和后端的桥梁；包含：
  - 图像处理接口 `process_images`
  - 异步OCR处理 `start_async_ocr`、`get_async_task_status`、`cancel_async_task`
  - 文件选择对话框 `select_files`
  - **拖拽上传API**: 新增 `upload_files` 方法处理拖拽文件的 base64 数据解码和保存
- **`ocr_service.pyw`** - OCR服务模块，处理图像文字识别
- **`table_extractor.pyw`** - 表格提取模块，从图像中提取表格数据
- **`file_exporter.pyw`** - 文件导出模块，支持Word和PDF导出
- **`config_manager.pyw`** - 配置管理模块，处理配置文件和历史记录
- **`async_processor.pyw`** - 异步任务处理器：负责任务提交、队列管理、进度上报与取消；提供 `submit_ocr_task`、`submit_batch_ocr_tasks`、`get_task_status`、`cancel_task` 等方法
- **`image_preprocessor.pyw`** - 图像预处理：去噪、旋转校正、裁剪、增强等，提高OCR识别质量
- **`text_postprocessor.pyw`** - 文本后处理：清洗、段落合并、正则修复，提升输出文本可读性
- **`batch_optimizer.pyw`** - 批处理优化：并发控制与内存占用优化，提升多图像处理效率
- **`cache_manager.pyw`** - 缓存/中间结果管理：避免重复计算，降低耗时
- **`error_manager.pyw`** - 统一错误模型与返回结构：与前端约定统一的错误响应格式
- **`logger.pyw`** - 统一日志与错误处理：集中日志记录、装饰器捕获异常并标准化返回
- **`performance_monitor.pyw`** - 性能监控：记录处理耗时与资源使用，辅助优化
- **`memory_manager.pyw`** - 内存监控与释放：避免峰值占用导致的崩溃

## 🎨 用户界面文件

### 📱 前端界面
- **`ui.html`** - 用户界面文件，基于HTML+CSS+JavaScript的现代化界面；包含：
  - 同步处理入口（立即识别与导出）
  - 异步处理入口 `start_async_ocr` 调用与结果监控 `startAsyncProgressMonitoring`
  - 任务状态轮询 `get_async_task_status`、任务取消 `cancel_async_task`、任务清理 `cleanup_async_tasks`
  - 进度条、状态提示以及完成结果展示
  - **拖拽上传功能**: 支持图像文件拖拽到指定区域进行上传，包含：
    - `handleDrop` 函数处理拖拽事件和文件转换
    - `fileToBase64` 转换函数解决浏览器文件访问限制
    - 拖拽区域视觉反馈和错误处理机制
    - 支持 JPG、JPEG、PNG、BMP、TIFF、WEBP 等多种图像格式

## ⚙️ 配置和数据文件

### 📋 配置文件
- **`config.json`** - 应用配置文件，存储API密钥、OCR引擎选择、导出格式默认值等
- **`scan_history.json`** - 扫描历史记录文件，记录处理时间、输出格式、合并模式等元数据
- **`logs/ocr_app_YYYYMMDD.log`** - 按日生成日志文件，记录运行状态与错误信息

### 📦 依赖与打包
- **`requirements.txt`** - Python依赖包清单（pywebview、requests、img2table、tesseract、fpdf、python-docx 等）
- **`LLM图像扫描工具.spec`** - PyInstaller打包配置文件；包含资源打包和入口脚本设定

## 📚 文档和工具文件

### 📖 项目文档
- **`CHANGELOG.md`** - 修改记录文档；每次功能/修复需新增条目并标注受影响文件
- **`项目文件分类.md`** - 本文件，项目文件分类说明；对新模块与交互进行补充维护
- **`项目重组完成报告.md`** - 项目结构重组总结，列出目录结构与路径调整

### 🔍 开发工具
- **`performance_test.py`** - 性能测试脚本：启动耗时统计与资源使用监测

## 🗂️ 系统和资源文件

### 💾 缓存文件
- **`__pycache__/`** - Python字节码缓存目录
  - `config_manager.cpython-313.pyc`
  - `file_exporter.cpython-313.pyc`
  - `main_api.cpython-313.pyc`
  - `ocr_service.cpython-313.pyc`
  - `table_extractor.cpython-313.pyc`

### 🔧 环境和资源
- **`.venv/`** - Python虚拟环境目录
- **`resources/`** - 资源文件目录
  - `bin/windows/` - Windows平台相关的二进制文件
- **`.gitattributes`** - Git属性配置文件

---

## 📊 文件重要性分级

### 🔴 核心文件（不可删除）
- `app.pyw` - 应用入口
- `main_api.pyw` - 核心API
- `async_processor.pyw` - 异步任务处理核心
- `ui.html` - 用户界面
- `config.json` - 配置文件
- 所有 `src/*.pyw` 业务模块文件

### 🟡 重要文件（建议保留）
- `requirements.txt` - 依赖管理
- `scan_history.json` - 历史记录
- `CHANGELOG.md` - 版本记录

### 🟢 辅助文件（可选）
- `performance_test.py` - 测试工具
- `app_optimized.pyw` - 备份文件
- `LLM图像扫描工具.spec` - 打包配置

### ⚪ 系统文件（自动生成）
- `__pycache__/` - 可删除，会自动重新生成
- `.venv/` - 虚拟环境，可重新创建

---

## 🎯 文件功能流程图

```
用户操作
    ↓
ui.html (前端界面)
  ├─ 同步处理 (立即识别与导出)
  ├─ 异步处理 (start_async_ocr → startAsyncProgressMonitoring)
  └─ 拖拽上传 (handleDrop → fileToBase64 → upload_files API)
    ↓
main_api.pyw (API接口)
  ├─ process_images(output_format, merge_mode)
  ├─ start_async_ocr(image_paths, output_format, merge_mode)
  │     ├─ async_processor.submit_batch_ocr_tasks(...)
  │     ├─ set_progress_callback(_on_async_progress)
  │     └─ set_completion_callback(_on_async_completion)
  └─ upload_files(files_data) - 处理拖拽文件的base64解码和临时保存
    ↓
┌─────────────────┬─────────────────┬─────────────────┐
│  ocr_service    │ table_extractor │ file_exporter   │
│  (文字识别)      │  (表格提取)      │  (文件导出)      │
└─────────────────┴─────────────────┴─────────────────┘
    ↓
config_manager.pyw (配置管理)
    ↓
config.json & scan_history.json (数据存储)
  + logs/ocr_app_YYYYMMDD.log (运行日志)
```

---

*最后更新: 2025-09-28 22:28*